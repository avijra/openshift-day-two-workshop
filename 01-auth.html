<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<title>Configuring Identity Providers</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Configuring Identity Providers</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_configure_htpasswd">Configure htpasswd</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add an entry for two htpasswd users, admin and developer. Assign admin a password of redhat and developer a password of developer.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create an HTPasswd authentication file named htpasswd in the ~/DO280/labs/auth-provider/ directory. Add the admin user with the password of redhat. The name of the file is arbitrary, but this exercise use the ~/DO280/labs/auth-provider/htpasswd file.</p>
<div class="paragraph">
<p>Use the htpasswd command to populate the HTPasswd authentication file with the user names and encrypted passwords. The -B option uses bcrypt encryption. By default, the htpasswd command uses MD5 encryption when you do not specify an encryption option.
Execute the following:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">htpasswd -c -B -b /tmp/htpasswd admin redhat
Adding password for user admin</code></pre>
</div>
</div>
</li>
<li>
<p>Add the developer user with a password of developer to the ~/DO280/labs/auth-provider/htpasswd file.</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">htpasswd -b /tmp/htpasswd developer developer
Adding password for user developer</code></pre>
</div>
</div>
</li>
<li>
<p>Review the contents of the /tmp/htpasswd file and verify that it includes two entries with hashed passwords: one for the admin user and another for the developer user.</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat /tmp/htpasswd
admin:$2y$05$QPuzHdl06IDkJssT.tdkZuSmgjUHV1XeYU4FjxhQrFqKL7hs2ZUl6
developer:$apr1$0Nzmc1rh$yGtne1k.JX6L5s5wNa2ye.</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Create a secret that contains the HTPasswd users file.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a secret from the /tmp/htpasswd file. To use the HTPasswd identity provider, you must define a secret with a key named htpasswd that contains the HTPasswd user file /tmp/htpasswd.</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc create secret generic localusers --from-file htpasswd=/tmp/htpasswd -n openshift-config
secret/localusers created</code></pre>
</div>
</div>
</li>
<li>
<p>Assign the admin user the cluster-admin role.</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc adm policy add-cluster-role-to-user cluster-admin admin
...output omitted...
clusterrole.rbac.authorization.k8s.io/cluster-admin added: "admin"</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Update the HTPasswd identity provider for the cluster so that your users can authenticate. Configure the custom resource file and update the cluster.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Export the existing OAuth resource to a file named oauth.yaml in the ~/DO280/labs/auth-provider directory.</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get oauth cluster -o yaml &gt; /tmp/oauth.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Edit the /tmp/oauth.yaml file with your preferred text editor. You can choose the names of the identityProviders and fileData structures. For this exercise, use the myusers and localusers values respectively.</p>
<div class="paragraph">
<p>The completed custom resource should match the following. Note that htpasswd, mappingMethod, name and type are at the same indentation level.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">apiVersion: config.openshift.io/v1
kind: OAuth
...output omitted...
spec:
  identityProviders:
  - htpasswd:
      fileData:
        name: localusers
    mappingMethod: claim
    name: myusers
    type: HTPasswd</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the custom resource defined in the previous step.</p>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc replace -f /tmp/oauth.yaml
oauth.config.openshift.io/cluster replaced</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_external_authentication_providers">Configuring External Authentication Providers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenShift supports a number of different authentication providers, and you can
find the complete list in the
<a href="https://docs.openshift.com/container-platform/4.9/authentication/understanding-identity-provider.html">understanding
identity provider configuration</a>. One of the most commonly used authentication
providers is LDAP, whether provided by Microsoft Active Directory or by other
sources.</p>
</div>
<div class="paragraph">
<p>OpenShift can perform user authentication against an LDAP server, and can also
configure group membership and certain RBAC attributes based on LDAP group
membership.</p>
</div>
<div class="sect2">
<h3 id="_background_ldap_structure">Background: LDAP Structure</h3>
<div class="paragraph">
<p>In this environment we are providing LDAP with the following user groups:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ose-user</code>: Users with OpenShift access</p>
<div class="ulist">
<ul>
<li>
<p>Any users who should be able to log-in to OpenShift must be members of this
group</p>
</li>
<li>
<p>All of the below mentioned users are in this group</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>ose-normal-dev</code>: Normal OpenShift users</p>
<div class="ulist">
<ul>
<li>
<p>Regular users of OpenShift without special permissions</p>
</li>
<li>
<p>Contains: <code>normaluser1</code>, <code>teamuser1</code>, <code>teamuser2</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>ose-fancy-dev</code>: Fancy OpenShift users</p>
<div class="ulist">
<ul>
<li>
<p>Users of OpenShift that are granted some special privileges</p>
</li>
<li>
<p>Contains: <code>fancyuser1</code>, <code>fancyuser2</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>ose-teamed-app</code>: Teamed app users</p>
<div class="ulist">
<ul>
<li>
<p>A group of users that will have access to the same OpenShift <strong>Project</strong></p>
</li>
<li>
<p>Contains: <code>teamuser1</code>, <code>teamuser2</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_examine_the_oauth_configuration">Examine the OAuth configuration</h4>
<div class="paragraph">
<p>Since this is a pure, vanilla OpenShift 4 installation, it has the default OAuth resource. You can examine that OAuth configuration with the following:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get oauth cluster -o yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  annotations:
    include.release.openshift.io/ibm-cloud-managed: "true"
    include.release.openshift.io/self-managed-high-availability: "true"
    include.release.openshift.io/single-node-developer: "true"
    release.openshift.io/create-only: "true"
  creationTimestamp: "2022-02-09T23:06:59Z"
  generation: 1
  name: cluster
  ownerReferences:
  - apiVersion: config.openshift.io/v1
    kind: ClusterVersion
    name: version
    uid: c9cbd13c-99bf-4e82-b2ad-690810a01f2f
  resourceVersion: "1715"
  uid: 1bedd82d-b235-4e39-af98-e40f411c3c8e
spec: {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a few things to note here. Firstly, there&#8217;s basically nothing here!
How does the <code>kubeadmin</code> user work, then? The OpenShift OAuth system knows to
look for a <code>kubeadmin</code> <strong>Secret</strong> in the <code>kube-system</code> <strong>Namespace</strong>. You can
examine it with the following:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get secret -n kube-system kubeadmin -o yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
data:
  kubeadmin: JDJhJDEwJFYwcVBXRjZGTlNOOU1RYUN6SGtJVGV4T3I5Ym9DbGRTT0VmNS44UGl2cWZOUGdsTnkvb3hT
kind: Secret
metadata:
  creationTimestamp: "2022-02-09T23:06:14Z"
  name: kubeadmin
  namespace: kube-system
  resourceVersion: "576"
  uid: 834a86fd-96e6-4d6a-8c16-6eca251b10f0
type: Opaque</code></pre>
</div>
</div>
<div class="paragraph">
<p>That <strong>Secret</strong> contains the encoded hash of the <code>kubeadmin</code> password. This
account will continue to work even after we configure a new <code>OAuth</code>. If you
want to disable it, you would need to delete the secret.</p>
</div>
<div class="paragraph">
<p>In a real-world environment, you will likely want to integrate with your
existing identity management solution. For this lab we are configuring LDAP
as our <code>identityProvider</code>. Here&#8217;s an example of the OAuth configuration. Look
for the element in <code>identityProviders</code> with <code>type: LDAP</code> like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: ldap <b class="conum">(1)</b>
    challenge: false
    login: true
    mappingMethod: claim <b class="conum">(2)</b>
    type: LDAP
    ldap:
      attributes: <b class="conum">(3)</b>
        id:
        - dn
        email:
        - mail
        name:
        - cn
        preferredUsername:
        - uid
      bindDN: "uid=openshiftworkshop,ou=Users,o=625fda0ad6e9143f7f00f3aa,dc=jumpcloud,dc=com" <b class="conum">(4)</b>
      bindPassword: <b class="conum">(5)</b>
        name: ldap-secret
      ca: <b class="conum">(6)</b>
        name: ca-config-map
      insecure: false
      url: "ldaps://ldap.jumpcloud.com/ou=Users,o=625fda0ad6e9143f7f00f3aa,dc=jumpcloud,dc=com?uid?sub?(memberOf=cn=ose-user,ou=Users,o=625fda0ad6e9143f7f00f3aa,dc=jumpcloud,dc=com)" <b class="conum">(7)</b>
  tokenConfig:
    accessTokenMaxAgeSeconds: 86400</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some notable fields under <code>identityProviders:</code>:</p>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>name</code>: The unique ID of the identity provider. It is possible to have
multiple authentication providers in an OpenShift environment, and OpenShift is
able to distinguish between them.</p>
</li>
<li>
<p><code>mappingMethod: claim</code>: This section has to do with how usernames are
assigned within an OpenShift cluster when multiple providers are configured. See
the
<a href="https://docs.openshift.com/container-platform/4.9/authentication/understanding-identity-provider.html#identity-provider-parameters_understanding-identity-provider">Identity provider parameters</a> section for more information.</p>
</li>
<li>
<p><code>attributes</code>: This section defines the LDAP fields to iterate over and
assign to the fields in the OpenShift user&#8217;s "account". If any attributes are
not found / not populated when searching through the list, the entire
authentication fails. In this case we are creating an identity that is
associated with the LDAP <code>dn</code>, an email address from the LDAP <code>mail</code>, a name from
the LDAP <code>cn</code>, and a username from the LDAP <code>uid</code>.</p>
</li>
<li>
<p><code>bindDN</code>: When searching LDAP, bind to the server as this user.</p>
</li>
<li>
<p><code>bindPassword</code>: Reference to the Secret that has the password to use when binding for searching.</p>
</li>
<li>
<p><code>ca</code>: Reference to the ConfigMap that contains the CA certificate to use for
validating the SSL certificate of the LDAP server.</p>
</li>
<li>
<p><code>url</code>: Identifies the LDAP server and the search to perform.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information on the specific details of LDAP authentication in
OpenShift you can refer to the
<a href="https://docs.openshift.com/container-platform/4.9/authentication/identity_providers/configuring-ldap-identity-provider.html" target="_blank" rel="noopener">Configuring
an LDAP identity provider</a> documentation.</p>
</div>
<div class="paragraph">
<p>To setup the LDAP identity provider we must:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a <code>Secret</code> with the bind password.</p>
</li>
<li>
<p>Create a <code>ConfigMap</code> with the CA certificate.</p>
</li>
<li>
<p>Update the <code>cluster</code> <code>OAuth</code> object with the LDAP identity provider.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As the <code>kubeadmin</code> user apply the OAuth configuration with <code>oc</code>.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc create secret generic ldap-secret --from-literal=bindPassword=b1ndP^ssword -n openshift-config
wget https://ssl-ccp.godaddy.com/repository/gd-class2-root.crt -O /tmp/ca.crt
oc create configmap ca-config-map --from-file=/tmp/support/ca.crt -n openshift-config
cat &lt;&lt;EOF | oc apply -f -
apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: ldap
    challenge: false
    login: true
    mappingMethod: claim
    type: LDAP
    ldap:
      attributes:
        id:
        - dn
        email:
        - mail
        name:
        - cn
        preferredUsername:
        - uid
      bindDN: "uid=openshiftworkshop,ou=Users,o=625fda0ad6e9143f7f00f3aa,dc=jumpcloud,dc=com"
      bindPassword:
        name: ldap-secret
      ca:
        name: ca-config-map
      insecure: false
      url: "ldaps://ldap.jumpcloud.com/ou=Users,o=625fda0ad6e9143f7f00f3aa,dc=jumpcloud,dc=com?uid?sub?(memberOf=cn=ose-user,ou=Users,o=625fda0ad6e9143f7f00f3aa,dc=jumpcloud,dc=com)"
  tokenConfig:
    accessTokenMaxAgeSeconds: 86400
EOF</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>We use <code>apply</code> because there is an existing <code>OAuth</code> object. If you used
<code>create</code> you would get an outright error that the object already exists. You
still get a warning, but that&#8217;s OK.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>This will trigger a redployment of the oAuth Operator. You can monitor the rollout with the following command.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc rollout status deployment/oauth-openshift -n openshift-authentication</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_syncing_ldap_groups_to_openshift_groups">Syncing LDAP Groups to OpenShift Groups</h4>
<div class="paragraph">
<p>In OpenShift, groups can be used to manage users and control permissions for
multiple users at once. There is a section in the documentation on how to
<a href="https://docs.openshift.com/container-platform/4.9/authentication/ldap-syncing.html" target="_blank" rel="noopener">sync
groups with LDAP</a>. Syncing groups involves running a program called <code>groupsync</code>
when logged into OpenShift as a user with <code>cluster-admin</code> privileges, and using
a configuration file that tells OpenShift what to do with the users it finds in
the various groups.</p>
</div>
<div class="paragraph">
<p>We have provided a <code>groupsync</code> configuration file for you:</p>
</div>
<div class="paragraph">
<p>View configuration file</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat &lt;&lt; 'EOF' &gt; /tmp/groupsync.yaml
kind: LDAPSyncConfig
apiVersion: v1
url: ldaps://ldap.jumpcloud.com
bindDN: uid=openshiftworkshop,ou=Users,o=625fda0ad6e9143f7f00f3aa,dc=jumpcloud,dc=com
bindPassword: b1ndP^ssword
rfc2307:
  groupsQuery:
    baseDN: ou=Users,o=625fda0ad6e9143f7f00f3aa,dc=jumpcloud,dc=com
    derefAliases: never
    filter: '(|(cn=ose-*))'
  groupUIDAttribute: dn
  groupNameAttributes:
  - cn
  groupMembershipAttributes:
  - member
  usersQuery:
    baseDN: ou=Users,o=625fda0ad6e9143f7f00f3aa,dc=jumpcloud,dc=com
    derefAliases: never
  userUIDAttribute: dn
  userNameAttributes:
  - uid
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>Without going into too much detail (you can look at the documentation), the
<code>groupsync</code> config file does the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>searches LDAP using the specified bind user and password</p>
</li>
<li>
<p>queries for any LDAP groups whose name begins with <code>ose-</code></p>
</li>
<li>
<p>creates OpenShift groups with a name from the <code>cn</code> of the LDAP group</p>
</li>
<li>
<p>finds the members of the LDAP group and then puts them into the created
OpenShift group</p>
</li>
<li>
<p>uses the <code>dn</code> and <code>uid</code> as the UID and name attributes, respectively, in
OpenShift</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Execute the <code>groupsync</code>:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc adm groups sync --sync-config=/tmp/groupsync.yaml --confirm</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see output like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>group/ose-fancy-dev
group/ose-user
group/ose-normal-dev
group/ose-teamed-app</pre>
</div>
</div>
<div class="paragraph">
<p>What you are seeing is the <strong>Group</strong> objects that have been created by the
<code>groupsync</code> command. If you are curious about the <code>--confirm</code> flag, check the
output of the help with <code>oc adm groups sync -h</code>.</p>
</div>
<div class="paragraph">
<p>If you want to see the <strong>Groups</strong> that were created, execute the following:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get groups</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see output like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME             USERS
ose-fancy-dev    fancyuser1, fancyuser2
ose-normal-dev   normaluser1, teamuser1, teamuser2
ose-teamed-app   teamuser1, teamuser2
ose-user         fancyuser1, fancyuser2, normaluser1, teamuser1, teamuser2</pre>
</div>
</div>
<div class="paragraph">
<p>Take a look at a specific group in YAML:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get group ose-fancy-dev -o yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>The YAML looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: user.openshift.io/v1
kind: Group
metadata:
  annotations:
    openshift.io/ldap.sync-time: 2022-04-23T17:26:0900200
    openshift.io/ldap.uid: cn=ose-fancy-dev,ou=Users,o=625fda0ad6e9143f7f00f3aa,dc=jumpcloud,dc=com
    openshift.io/ldap.url: ldap.jumpcloud.com:636
  creationTimestamp: "2022-04-23T15:26:09Z"
  labels:
    openshift.io/ldap.host: ldap.jumpcloud.com
  name: ose-fancy-dev
  resourceVersion: "832312"
  uid: ae1f122b-bdcb-4ae4-a6e2-01abad39783d
users:
- fancyuser1
- fancyuser2</code></pre>
</div>
</div>
<div class="paragraph">
<p>OpenShift has automatically associated some LDAP metadata with the <strong>Group</strong>, and
has listed the users who are in the group.</p>
</div>
<div class="paragraph">
<p>What happens if you list the <strong>Users</strong>?</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get user</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will get:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>No resources found.</pre>
</div>
</div>
<div class="paragraph">
<p>Why would there be no <strong>Users</strong> found? They are clearly listed in the <strong>Group</strong>
definition.</p>
</div>
<div class="paragraph">
<p><strong>Users</strong> are not actually created until the first time they try to log in. What
you are seeing in the <strong>Group</strong> definition is simply a placeholder telling
OpenShift that, if it encounters a <strong>User</strong> with that specific ID, that it should
be associated with the <strong>Group</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_change_group_policy">Change Group Policy</h4>
<div class="paragraph">
<p>In your environment, there is a special group of super developers called
<em>ose-fancy-dev</em> who should have special <code>cluster-reader</code> privileges. This is a role
that allows a user to view administrative-level information about the cluster.
For example, they can see the list of all <strong>Projects</strong> in the cluster.</p>
</div>
<div class="paragraph">
<p>Change the policy for the <code>ose-fancy-dev</code> <strong>Group</strong>:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc adm policy add-cluster-role-to-group cluster-reader ose-fancy-dev</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>If you are interested in the different roles that come with OpenShift, you can
learn more about them in the
<a href="https://docs.openshift.com/container-platform/4.9/authentication/using-rbac.html" target="_blank" rel="noopener">role-based access control (RBAC)</a> documentation.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_examine_cluster_reader_policy">Examine <code>cluster-reader</code> policy</h4>
<div class="paragraph">
<p>Go ahead and login as a regular user:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc login -u normaluser1 -p Op#nSh1ft</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, try to list <strong>Projects</strong>:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get projects</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>No resources found.</pre>
</div>
</div>
<div class="paragraph">
<p>Now, login as a member of <code>ose-fancy-dev</code>:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc login -u fancyuser1 -p Op#nSh1ft</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then perform the same <code>oc get projects</code> command:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get projects</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will now see the list of all of the projects in the cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[~] $ oc get projects
NAME                                               DISPLAY NAME   STATUS
default                                                           Active
kube-node-lease                                                   Active
kube-public                                                       Active
kube-system                                                       Active
lab-ocp-cns                                                       Active
openshift                                                         Active
openshift-apiserver                                               Active
...</pre>
</div>
</div>
<div class="paragraph">
<p>You should now be starting to understand how RBAC in OpenShift Container
Platform can work.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_projects_for_collaboration">Create Projects for Collaboration</h4>
<div class="paragraph">
<p>Make sure you login as the cluster administrator:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc login -u admin -p redhat</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, create several <strong>Projects</strong> for people to collaborate:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc adm new-project app-dev --display-name="Application Development"
oc adm new-project app-test --display-name="Application Testing"
oc adm new-project app-prod --display-name="Application Production"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You have now created several <strong>Projects</strong> that represent a typical Software
Development Lifecycle setup. Next, you will configure <strong>Groups</strong> to grant
collaborative access to these projects.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Creating projects with <code>oc adm new-project</code> does <strong>not</strong> use the project request
process or the project request template. These projects will not have quotas or
limitranges applied by default. A cluster administrator can "impersonate" other
users, so there are several options if you wanted these projects to get
quotas/limit ranges:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>use <code>--as</code> to specify impersonating a regular user with <code>oc new-project</code></p>
</li>
<li>
<p>use <code>oc process</code> and provide values for the project request template, piping
into create (eg: <code>oc process &#8230;&#8203; | oc create -f -</code>). This will create all of
the objects in the project request template, which would include the quota and
limit range.</p>
</li>
<li>
<p>manually create/define the quota and limit ranges after creating the projects.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For these exercises it is not important to have quotas or limit ranges on these
projects.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_map_groups_to_projects">Map Groups to Projects</h4>
<div class="paragraph">
<p>As you saw earlier, there are several roles within OpenShift that are
preconfigured. When it comes to <strong>Projects</strong>, you similarly can grant view, edit,
or administrative access. Let&#8217;s give our <code>ose-teamed-app</code> users access to edit the
development and testing projects:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc adm policy add-role-to-group edit ose-teamed-app -n app-dev
oc adm policy add-role-to-group edit ose-teamed-app -n app-test</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then give them access to view production:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc adm policy add-role-to-group view ose-teamed-app -n app-prod</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, give the <code>ose-fancy-dev</code> group edit access to the production project:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc adm policy add-role-to-group edit ose-fancy-dev -n app-prod</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_examine_group_access">Examine Group Access</h4>
<div class="paragraph">
<p>Log in as <code>normaluser1</code> and see what <strong>Projects</strong> you can see:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc login -u normaluser1 -p Op#nSh1ft
oc get projects</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should get:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>No resources found.</pre>
</div>
</div>
<div class="paragraph">
<p>Then, try <code>teamuser1</code> from the <code>ose-teamed-app</code> group:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc login -u teamuser1 -p Op#nSh1ft
oc get projects</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should get:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME       DISPLAY NAME              STATUS
app-dev    Application Development   Active
app-prod   Application Production    Active
app-test   Application Testing       Active</pre>
</div>
</div>
<div class="paragraph">
<p>You did not grant the team users edit access to the production project. Go ahead
and try to create something in the production project as <code>teamuser1</code>:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc project app-prod
oc new-app docker.io/siamaksade/mapit</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see that it will not work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>error: can't lookup images: imagestreamimports.image.openshift.io is forbidden: User "teamuser1" cannot create resource "imagestreamimports" in API group "image.openshift.io" in the namespace "app-prod"
error:  local file access failed with: stat docker.io/siamaksade/mapit: no such file or directory
error: unable to locate any images in image streams, templates loaded in accessible projects, template files, local docker images with name "docker.io/siamaksade/mapit"

Argument 'docker.io/siamaksade/mapit' was classified as an image, image~source, or loaded template reference.

The 'oc new-app' command will match arguments to the following types:

  1. Images tagged into image streams in the current project or the 'openshift' project
     - if you don't specify a tag, we'll add ':latest'
  2. Images in the Docker Hub, on remote registries, or on the local Docker engine
  3. Templates in the current project or the 'openshift' project
  4. Git repository URLs or local paths that point to Git repositories

--allow-missing-images can be used to point to an image that does not exist yet.

See 'oc new-app -h' for examples.</pre>
</div>
</div>
<div class="paragraph">
<p>This failure is exactly what we wanted to see as the production project is setup to edit resources.</p>
</div>
<div class="paragraph">
<p>If you try with an user that has full privileges you should be able to create resources within this production project.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-01-10 13:02:25 +0800
</div>
</div>
</body>
</html>