<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<title>Windows Containers</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="_windows_containers">Windows Containers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Windows Container Support for OpenShift provides support for running
Microsoft Windows Server containers on OpenShift Container Platform. For
those that administer environments with a mix of Linux and Windows
workloads, OpenShift allows you to deploy containerized Windows workloads
running on Windows Server on the same platfrom as your containerized Linux workloads.</p>
</div>
<div class="paragraph">
<p>Windows container workloads are supported for clusters running on the
following providers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Amazon Web Services (AWS)</p>
</li>
<li>
<p>Microsoft Azure</p>
</li>
<li>
<p>VMware vSphere</p>
</li>
<li>
<p>Bare Metal (via <a href="https://docs.openshift.com/container-platform/4.10/windows_containers/byoh-windows-instance.html">BYOH</a>)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For more information  about what versions of Windows Server are supported, please see the <a href="https://docs.openshift.com/container-platform/4.10/windows_containers/understanding-windows-container-workloads.html">official documentation</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this lab, you&#8217;ll get hands on experence on how to deploy a Windows
worker node and how to deploy workloads onto an OpenShift platform with
Windows and Linux nodes.</p>
</div>
<div class="sect2">
<h3 id="_windows_machineconfig_operator">Windows MachineConfig Operator</h3>
<div class="paragraph">
<p>The Windows Machine Config Operator (WMCO) is the entry point for
OpenShift Administrators who want to run containerized Windows workloads
on their clusters.</p>
</div>
<div class="paragraph">
<p>It allows Cluster Administrators to add a Windows worker nodes as a day 2
operation with a prescribed configuration to an OpenShift cluster and
enable scheduling of Windows workloads.</p>
</div>
<div class="paragraph">
<p>The following diagram is a high level illustration on how the WMCO works.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/wmcodiagram.png" alt="wmco diagram">
</div>
<div class="title">Figure 1. Windows MachineConfig Operator Design</div>
</div>
<div class="paragraph">
<p>The Windows Machine Config Operator is a Linux-based operator that runs on
Linux-based nodes on OpenShift. It watches for Machine Objects that are
of type Windows and connects to them over SSH.</p>
</div>
<div class="paragraph">
<p>During setup, the WMCO will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Transfer needed binaries to the Windows node.</p>
</li>
<li>
<p>Installs and confiugres the Kubelet.</p>
</li>
<li>
<p>Install and run it&#8217;s own overlay network (Hybrid-overlay network).</p>
</li>
<li>
<p>Confiugre the CNI on the Kubelet.</p>
</li>
<li>
<p>Set up kube-proxy.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information please see the <a href="https://docs.openshift.com/container-platform/4.10/windows_containers/understanding-windows-container-workloads.html">official documentation</a>.</p>
</div>
<div class="sect3">
<h4 id="_prerequisites">Prerequisites</h4>
<div class="paragraph">
<p>This cluster has already been installed to support Windows Nodes and
Windows Containers workloads. Therefore, we will be exploring the
prerequisites by looking at the current configuration of this cluster.</p>
</div>
<div class="paragraph">
<p>Before proceeding, make sure you&#8217;re <code>admin</code></p>
</div>
<div class="paragraph">
<p>The first requisite is that you must be running OpenShift version 4.6
or newer. This cluster should have been installed at a supported version.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc version</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next requisite is that the cluster must be installed with
<code>OVNKubernetes</code> as the SDN for OpenShift. This can only be done at
install time in the <code>install-config.yaml</code> file. This file is stored on
the cluster after install. Take a look at the setting.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc extract cm/cluster-config-v1 -n kube-system --to=- | yq e '.networking.networkType' -</code></pre>
</div>
</div>
<div class="paragraph">
<p>This should output <code>OVNKubernetes</code> as the network type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Learn more about the <code>install-config.yaml</code> file at the <a href="https://docs.openshift.com/container-platform/4.10/installing/installing_aws/installing-aws-customizations.html#installation-aws-config-yaml_installing-aws-customizations">official documentation page</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The next requisite is the cluster must be set up with overlay hybrid
networking. This is another step that can only be done at install
time. You can verify that the configuration has been done by running
the following:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get network.operator cluster -o yaml | yq e '.spec.defaultNetwork' -</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should look like this. As you can see, the
<code>hybridOverlayConfig</code> was set up. This is the overlay network setup on
the Windows Node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">ovnKubernetesConfig:
  genevePort: 6081
  hybridOverlayConfig:
    hybridClusterNetwork:
      - cidr: 10.132.0.0/14
        hostPrefix: 23
  mtu: 8901
  policyAuditConfig:
    destination: "null"
    maxFileSize: 50
    rateLimit: 20
    syslogFacility: local0
type: OVNKubernetes</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
To read more about how to setup HybridNetworking, please see the <a href="https://docs.openshift.com/container-platform/4.10/networking/ovn_kubernetes_network_provider/configuring-hybrid-networking.html#configuring-hybrid-ovnkubernetes_configuring-hybrid-networking">official doc</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To summarize, in order to use Windows Containers on OpenShift. You will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OpenShift version 4.6 or newer.</p>
</li>
<li>
<p><code>OVNKubernetes</code> as the SDN.</p>
</li>
<li>
<p>Additionally set up hybrid overlay networking.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note, that all of this is done at install time. There&#8217;s, currently,
no way to configure a cluster for Windows Containers post install.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
If you&#8217;re not seeing the above output, you will not be able to continue with this lab. If you see that this cluster doesn&#8217;t meet the requirements, please see your workshop proctor.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installing_the_wmco">Installing the WMCO</h3>
<div class="paragraph">
<p>Before you can deploy a Windows Node, you will need to install the Windows
Machine Config Operator (WMCO). This can be done via the OpenShift Web
Console. Use the "Console" tab, or open the console in another tab if it isn&#8217;t open already.</p>
</div>
<div class="listingblock copypaste">
<div class="content">
<pre class="highlight"><code>oc whoami --show-console</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you are logged in, navigate to <strong>Operators</strong> ~&gt; <strong>OperatorHub</strong> menu.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/operatorhub-menu.png" alt="OperatorHub Menu">
</div>
<div class="title">Figure 2. OperatorHub</div>
</div>
<div class="paragraph">
<p>Now type <strong>Windows Machine Config Operator</strong> in the <strong>Filter by <em>keyword&#8230;&#8203;</em></strong>
box. Click on the <strong>Windows Machine Config Operator</strong> card, taking care that
you don&#8217;t use the community version.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/wmco-card.png" alt="WMCO Install Card">
</div>
<div class="title">Figure 3. WMCO Operator</div>
</div>
<div class="paragraph">
<p>On the overview page, select <strong>Install</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/install-overview.png" alt="WMCO Overview">
</div>
<div class="title">Figure 4. WMCO Operator Overview</div>
</div>
<div class="paragraph">
<p>On the <strong>Install Operator</strong> overview page, make sure you have <strong>stable</strong>
selected in the "Update channel" section. Also, in the "Installation mode"
section, leave <strong>A specifc namespace on the cluster</strong> selected. Leave the
"Installed Namspace" section as <strong>Operator recommended Namespace</strong> and tick
on <strong>Enable Cluster Monitoring</strong>. Finally, leave the "Approval strategy"
as <strong>Automatic</strong>. Then click <strong>Install</strong>. Use the below graphic to guide you.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/wmco-install-operator-overview-page.png" alt="WMCO Install Overview">
</div>
<div class="title">Figure 5. WMCO Install Operator Overview</div>
</div>
<div class="paragraph">
<p>The "Installing Operator" status page will come up.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/installing-the-wmco-status-operator.png" alt="WMCO Installing">
</div>
<div class="title">Figure 6. WMCO Install Operator status page</div>
</div>
<div class="paragraph">
<p>When the screen says "ready for use", the WMCO Operator is successfully installed.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/wmco-ready-for-use.png" alt="WMCO Installing">
</div>
<div class="title">Figure 7. WMCO Install Operator status page</div>
</div>
<div class="paragraph">
<p>Back on the cli, you should now see the WMCO pod running.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get pods -n openshift-windows-machine-config-operator</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should look something like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">NAME                                               READY   STATUS    RESTARTS   AGE
windows-machine-config-operator-7ddc9f7d9b-vx4vx   1/1     Running   0          43m</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the operator is up and running. You are ready to install a Windows Node.</p>
</div>
<div class="sect3">
<h4 id="_installing_a_windows_node">Installing a Windows Node.</h4>
<div class="paragraph">
<p>In order for the WMCO to setup the Windows Node, it will need an ssh key
to the cloud provider. The cloud provider will then mint a new keypair
based on the private key provided. The WMCO will then use this key to
login to the Windows Node and set it up as an OpenShift Node.</p>
</div>
<div class="paragraph">
<p>Generate an ssh key for the WMCO to use:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ssh-keygen -t rsa -f ${HOME}/.ssh/winkey -q -N ''</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you&#8217;ve generated the key, add it as a secret to the
<code>openshift-windows-machine-config-operator</code> namespace.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc create secret generic cloud-private-key --from-file=private-key.pem=${HOME}/.ssh/winkey -n openshift-windows-machine-config-operator</code></pre>
</div>
</div>
<div class="paragraph">
<p>This secret is used by the WMCO Operator to setup the Windows Node. Verify
that it was created before you proceed.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get secret -n openshift-windows-machine-config-operator cloud-private-key</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the WMCO Operator is up and running, and the ssh key loaded into
the cluster as a secret, you can now deploy a Windows Node. How do you
build a Windows Node? The same way you create OpenShift Linux nodes,
with the MachineAPI</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you&#8217;re unfamiliar with the MachineAPI, you can do the <a href="machinesets.html">MachineSets, Machines, and Nodes</a> lab to get familair with the concepts.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>First, we will be creating a MachineSet for Windows Nodes. We will then
explore important sections of the YAML.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">support/generate-windows-ms.sh</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For more information on how to create a Windows MachineSet YAML see the <a href="https://docs.openshift.com/container-platform/4.10/windows_containers/creating_windows_machinesets/creating-windows-machineset-aws.html">official docs</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This should create the <code>windows-ms.yaml</code> file in your home directory.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ls -l ~/windows-ms.yaml</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Feel free to take a look at the file if you wish. You&#8217;ll see that it doesn&#8217;t differ from a Linux MachineSet.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Windows MachineSet is labeled with an Operating System ID of <code>Windows</code>. The following command will show the label of <code>machine.openshift.io/os-id: Windows</code> for the MachineSet.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">yq e '.metadata.labels' ~/windows-ms.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>All the Windows Machines will have the <code>worker</code> label. The Windows Node
will be treated like any other node in the cluster.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">yq e '.spec.template.spec.metadata.labels' ~/windows-ms.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>The AMI ID is of a Windows Server 2019 AMI.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">yq e '.spec.template.spec.providerSpec.value.ami.id' ~/windows-ms.yaml</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You will need to use an AMI of a supported version of Windows Server. For more information, consult the <a href="https://docs.openshift.com/container-platform/4.10/windows_containers/windows-containers-release-notes-4-x.html#supported-windows-server-versions">official documentation</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>One last thing to note, is the user data secret.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">yq e '.spec.template.spec.providerSpec.value.userDataSecret.name' ~/windows-ms.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>This secret is generated by the WMCO when it was installed.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get secret windows-user-data -n openshift-machine-api</code></pre>
</div>
</div>
<div class="paragraph">
<p>Apply the YAML to create the Windows MachineSet on the cluster.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc apply -f ~/windows-ms.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can now see the status of the MachineSet.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get machinesets  -n openshift-machine-api -l machine.openshift.io/os-id=Windows</code></pre>
</div>
</div>
<div class="paragraph">
<p>This should show the following output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">NAME                                       DESIRED   CURRENT   READY   AVAILABLE   AGE
cluster1-wrkjp-windows-worker-us-east-1a   1         1                             9s</code></pre>
</div>
</div>
<div class="paragraph">
<p>The MachineSet has the replica set to 1. The MachineAPI will see that desired state and, in turn, create a Windows Machine. This machine will eventually turn into a node. See the status of the machine with the following command.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get machines  -n openshift-machine-api -l machine.openshift.io/os-id=Windows</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the Machine is up and running, the WMCO will configure it. You can follow that status by looking at the WMCO pod log.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc logs -l name=windows-machine-config-operator -n openshift-windows-machine-config-operator   -f</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can exit by pressing kbd:[Ctrl+C].</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you wish, you can wait until you see "Windows VM has been configured as a worker node" log message. Otherwise, go ahead and break out of following the log.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This Machine will create a Windows Node and the WMCO will add it to the cluster. You
can see the node with the following command.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get nodes -l kubernetes.io/os=windows</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It&#8217;ll take up to 15 mintues to see the Windows Node appear. It&#8217;s recommneded to run a <code>watch</code> on <code>oc get nodes -l kubernetes.io/os=windows</code> so you can see when the node appears. Now will be a good time to take a break.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The output should look something like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">NAME                          STATUS   ROLES    AGE   VERSION
ip-10-0-140-10.ec2.internal   Ready    worker   22m   v1.20.0-1081+d0b1ad449a08b3</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_managing_a_windows_node">Managing a Windows Node</h4>
<div class="paragraph">
<p>Now that the Windows Node is up and running, you will be able to manage
it like you would a Linux node. You will be able to scale and delete
nodes using the MachineAPI.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Windows Machine Config Operator is not responsible for Windows operating system updates. The Cluster Administrator provides the Windows image while creating the VMs and hence, the Cluster Administrator is responsible for providing an updated image. The Cluster Administrator can provide an updated image by changing the image in the MachineSet spec.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Currently, you have one Windows node.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get nodes -l kubernetes.io/os=windows</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to add another node, you will just scale the corespoinding
MachineSet. Currently, you should have one</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get machineset -l machine.openshift.io/os-id=Windows -n openshift-machine-api</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should have the below output. It shows that you have one Windows
Machine managed by this MachineSet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">NAME                                       DESIRED   CURRENT   READY   AVAILABLE   AGE
cluster1-zzv5j-windows-worker-us-east-1a   1         1         1       1           138m</code></pre>
</div>
</div>
<div class="paragraph">
<p>To add another Windows Node, scale the Windows MachineSet to two
replicas. This will create a new Windows Machine, and then the WMCO will
add it as an OpenShift Node.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc scale machineset -l machine.openshift.io/os-id=Windows -n openshift-machine-api --replicas=2</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Just like when you created the inital Windows Node, this can take upwards of 15 minutes. This can be another good time to take a small break.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After some time, another Windows Node will have joined the cluster.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get nodes -l kubernetes.io/os=windows</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s an example output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">NAME                           STATUS   ROLES    AGE     VERSION
ip-10-0-139-232.ec2.internal   Ready    worker   15m     v1.20.0-1081+d0b1ad449a08b3
ip-10-0-143-146.ec2.internal   Ready    worker   3h18m   v1.20.0-1081+d0b1ad449a08b3</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see how easy it is to manage a Windows Machine
with the MachineAPI on OpenShift. It is managed by the
same system as your Linux Nodes. You can even attach the Windows
<a href="https://docs.openshift.com/container-platform/4.10/machine_management/applying-autoscaling.html">MachineSet Autoscaler</a> as well</p>
</div>
<div class="paragraph">
<p>Remove this node by scaling the Windows MachineSet back down to 1.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc scale machineset -l machine.openshift.io/os-id=Windows -n openshift-machine-api --replicas=1</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Please scale your Windows MachineSet to 1 before starting the next exercise.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After some time, you should be back at 1 Windows node.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get nodes -l kubernetes.io/os=windows</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_exploring_the_windows_node">Exploring The Windows Node</h4>
<div class="paragraph">
<p>Now that you&#8217;ve learned how to manage a Windows Node, we will explore how this
node is set up. You can access this Windows node via the same mechanism
as the WMCO, via SSH.</p>
</div>
<div class="paragraph">
<p>Since this cluster was installed in the cloud, the Windows Node isn&#8217;t
exposed to the public internet. So we will need to deploy an ssh bastion Pod.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For information on how to enable RDP on an AWS instance, please see the <a href="https://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/connecting_to_windows_instance.html">official documentation</a> on their website.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The ssh bastion pod can be deployed using the Deployment YAML provided to you in this lab.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc apply -n openshift-windows-machine-config-operator -f support/win-node-ssh.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can wait for the rollout of this ssh bastion pod.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc rollout status deploy/winc-ssh -n openshift-windows-machine-config-operator</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once rolled out, you should have the ssh bastion pod running.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get pods -n openshift-windows-machine-config-operator -l app=winc-ssh</code></pre>
</div>
</div>
<div class="paragraph">
<p>The ssh bastion pod mounts the ssh key needed to login to the Windows Node.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">yq e '.spec.template.spec.volumes' support/win-node-ssh.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to be able to ssh into this node you will need the hostname. Get
this hostname with the following command and make note of it.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get nodes -l kubernetes.io/os=windows</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now open a bash session into the ssh bastion pod using the <code>oc exec</code> command.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc exec -it deploy/winc-ssh -n openshift-windows-machine-config-operator -- bash</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the provided <code>sshcmd.sh</code> command built into the pod to login to the
Windows Node. Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">bash-4.4$ sshcmd.sh ip-10-0-140-10.ec2.internal</code></pre>
</div>
</div>
<div class="paragraph">
<p>This should drop you into a PowerShell session. It should look something like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">Windows PowerShell
Copyright (C) Microsoft Corporation. All rights reserved.

PS C:\Users\Administrator&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once on the Windows Node, you can see the <code>docker</code>, <code>kubelet</code>, and the <code>hybrid-overlay-node</code> process running.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">Get-Process | ?{ $_.ProcessName -match "kube|overlay|docker" }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see the following output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">Handles  NPM(K)    PM(K)      WS(K)     CPU(s)     Id  SI ProcessName
-------  ------    -----      -----     ------     --  -- -----------
    342      20    80008      46020      16.95   2640   0 dockerd
    245      18    31740      38364      13.02   2376   0 hybrid-overlay-node
    416      28    59812      84740     176.48   2036   0 kubelet
    302      23    36272      46056      61.64   3968   0 kube-proxy</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Currently, the Docker-formatted container runtime is used in Windows nodes. Kubernetes is deprecating Docker as a container runtime; you can reference the Kubernetes documentation for more information about the <a href="https://kubernetes.io/blog/2020/12/02/dont-panic-kubernetes-and-docker/">Docker deprecation</a>. <code>Containerd</code> will be the new supported container runtime for Windows nodes in a future release of Kubernetes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>These are the main components needed to run a Windows Node. Remember that
this node is managed the same way as a Linux node, Via the MachineAPI;
so you won&#8217;t have to do much with this Windows Node.</p>
</div>
<div class="paragraph">
<p>One caveat, however, is that Windows Containers can be quite large
(in some cases up to 8Gigs in size!). This will timeout the deployment
of your Windows Containers workloads. A workaround is to "pre-pull"
any base containers.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker pull mcr.microsoft.com/windows/servercore:ltsc2019</code></pre>
</div>
</div>
<div class="paragraph">
<p>This pull process can take some time. While it&#8217;s pulling,
take note of the version of the container you are pulling is
<code>mcr.microsoft.com/windows/servercore:ltsc2019</code>. The version you
need to pull will differ between Windows Server versions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Since the OS Kernel differs from version to version of Windows Server, the base container needed will differ depending on what version of Windows Server you&#8217;re running. Please see <a href="https://docs.microsoft.com/en-us/virtualization/windowscontainers/deploy-containers/version-compatibility?tabs=windows-server-20H2%2Cwindows-10-20H2">Microsoft&#8217;s documentation</a> about supported container image versions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After some time, the image should be on the host.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker images</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see the following output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">REPOSITORY                             TAG        IMAGE ID       CREATED       SIZE
mcr.microsoft.com/windows/servercore   ltsc2019   9a0a02eca0e6   4 weeks ago   5.7GB</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that you&#8217;ve pre-pulled the Windows Server container image, you can
exit out of the PowerShell session.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">exit</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also exit out of the bash container session as well.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">exit</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_running_a_windows_container_workload">Running a Windows Container Workload</h4>
<div class="paragraph">
<p>Before you deploy a sample Windows Container workload, let&#8217;s explore
how the container gets scheduled on the Windows node.</p>
</div>
<div class="paragraph">
<p>If you run an <code>oc describe</code> on the Windows Node, you&#8217;ll see it has
a taint.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Please see the <a href="08-taints-and-tolerations.html">Taints and Tolerations lab</a> to get more familiar about how they work.
</td>
</tr>
</table>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc describe nodes -l kubernetes.io/os=windows | grep Taint</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see the following output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">Taints:             os=Windows:NoSchedule</code></pre>
</div>
</div>
<div class="paragraph">
<p>Every Windows Node will come with this taint by default. This taint will
"repel" all workloads that don&#8217;t tolerate this taint. It is a part of
the WMCO&#8217;s job to ensure that all Windows Nodes have this taint.</p>
</div>
<div class="paragraph">
<p>In this lab, there is a sample workload saved under
<code>~/support/winc-sample-workload.yaml</code>. Let&#8217;s explore this file a bit
before we apply it.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">yq e '.items[2].spec.template.spec.tolerations' support/winc-sample-workload.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should look something like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">- key: "os"
  value: "Windows"
  Effect: "NoSchedule"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This sample workload has the toleration in place to be able to run on
the Windows Node. However, that&#8217;s not enough. A <code>nodeSelector</code> will need
to be present as well.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">yq e '.items[2].spec.template.spec.nodeSelector' support/winc-sample-workload.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should look something like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubernetes.io/os: windows</code></pre>
</div>
</div>
<div class="paragraph">
<p>So here, the <code>nodeSelector</code> will place this container on the Windows
Node. Furthermore, the appropriate toleration is in place so the Windows
Node won&#8217;t repel the container.</p>
</div>
<div class="paragraph">
<p>One last thing to look at. Take a look at the container that is being deployed.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">yq e '.items[2].spec.template.spec.containers[0].image' support/winc-sample-workload.yaml</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Note that this container has to be prepulled onto the Windows Node. Please see the <a href="#_exploring_the_windows_node">Exploring The Windows Node</a> exercise for more info.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Apply this YAML file to deploy the sample workload.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc apply -f support/winc-sample-workload.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wait for the deployment to finish rolling out.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc rollout status deploy/win-webserver -n winc-sample</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you check the pod, you can see that it&#8217;s running on the Windows
Node. Look at the wide output of the Pod and select the Windows Node
to verify.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get pods -n winc-sample  -o wide
oc get nodes -l kubernetes.io/os=windows</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make a note of the Windows Node name, we will log into the node using
the bastion ssh container.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc exec -it deploy/winc-ssh -n openshift-windows-machine-config-operator -- bash</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now log into the Windows Node using the hostname. Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">bash-4.4$ sshcmd.sh ip-10-0-140-10.ec2.internal</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, you can see the Windows container running on the node.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker ps</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you&#8217;ll see the Container running along with the <code>pause</code> container
as well. Here is an example output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">CONTAINER ID   IMAGE                                          COMMAND                  CREATED          STATUS          PORTS     NAMES
68e3e51ff76d   9a0a02eca0e6                                   "powershell.exe -com…"   38 seconds ago   Up 36 seconds             k8s_win
dowswebserver_win-webserver-6bc7795585-prgrj_winc-sample_34c3f4b7-4e74-42d4-9d51-cac59e4d1b58_0
f5cdf462e916   mcr.microsoft.com/oss/kubernetes/pause:3.4.1   "/pause.exe"             39 seconds ago   Up 38 seconds             k8s_POD
_win-webserver-6bc7795585-prgrj_winc-sample_34c3f4b7-4e74-42d4-9d51-cac59e4d1b58_0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Go ahead an logout of the Windows Node</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">exit</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also exit out of the bash container session as well.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">exit</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can interact with the Windows Container workload as you would any
other pod. For instance you can remote shell into the container itself
by calling the <code>Powershell</code> command.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc -n winc-sample exec -it $(oc get pods -l app=win-webserver -n winc-sample -o name ) -- powershell</code></pre>
</div>
</div>
<div class="paragraph">
<p>This should put you in a <code>Powershell</code> session in the Windows Container. It
should look something like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">Windows PowerShell
Copyright (C) Microsoft Corporation. All rights reserved.

PS C:\&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, you can query the TaskManager to see the HTTP process running.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You may have to press <code>ENTER</code> to execute the following commands while in the Windows Container for them to run.
</td>
</tr>
</table>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">tasklist /M /FI "IMAGENAME eq powershell.exe"  | Select-String -Pattern http</code></pre>
</div>
</div>
<div class="paragraph">
<p>Go ahead an logout of the Windows Container.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">exit</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can interact with the Windows Container <code>Deployment</code> the same as you
would for a Linux one. Scale the <code>Deployment</code> of the Windows Container:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc scale deploy/win-webserver -n winc-sample --replicas=2</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should now have two Pods running.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get pods -n winc-sample</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_running_a_mixed_linuxwindows_container_workload">Running a Mixed Linux/Windows Container Workload.</h4>
<div class="paragraph">
<p>With Windows Containers support for OpenShift; You also have the ability
to run application stacks of mixed workloads. This gives you the
ability to run an application stack consisting of both Linx and Windows
Containers.</p>
</div>
<div class="paragraph">
<p>In this section, we will show how you can run Windows workloads that
work together with Linux workloads.</p>
</div>
<div class="paragraph">
<p>You will be deploying a sample application stack that delivers an
eCommerce site, The NetCandy Store. This application is built using
Windows Containers working together with Linux Containers.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mixed-windows-and-linux-workloads.png" alt="netcandystore diagram">
</div>
</div>
<div class="paragraph">
<p>This application consists of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Windows Container running a .NET v4 frontend, which is consuming a backend service.</p>
</li>
<li>
<p>Linux Container running a .NET Core backend service, which is using a database.</p>
</li>
<li>
<p>Linux Container running a MSSql database.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will be using a helm chart to deploy the sample application. In
order to successfully deploy the application stack, make sure you&#8217;re
<code>admin</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For more information about <code>helm</code> and how it can be used as a package manager for your containerized workloads, please see the <a href="https://docs.openshift.com/container-platform/4.10/cli_reference/helm_cli/getting-started-with-helm-on-openshift-container-platform.html">OpenShift documentation</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you&#8217;ve verified you are a cluster admin, you will need to extract
some information. You will need the hostname of the Windows node
installed and the ssh key used to login to the Windows Node.</p>
</div>
<div class="paragraph">
<p>The reason for this is part of the Helm Chart deploys a <code>Job</code> that downloads the
image of the frontend application as a <a href="https://helm.sh/docs/topics/charts_hooks/#the-available-hooks">pre-deploy hook</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Please revist the <a href="#_exploring_the_windows_node">Exploring The Windows Node</a> exercise for more info on why the downloading of the image is needed.
</td>
</tr>
</table>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export WSSHKEY=$(oc get secret cloud-private-key -n openshift-windows-machine-config-operator -o jsonpath='{.data.private-key\.pem}')
export WNODE=$(oc get nodes -l kubernetes.io/os=windows -o jsonpath='{.items[0].metadata.name}')</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next add the Red Hat Developer Demos Helm repository.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">helm repo add redhat-demos https://redhat-developer-demos.github.io/helm-repo
helm repo update</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the two variables exported, and the helm repo added, you can install
the application stack using the <code>helm</code> cli.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">helm install ncs --namespace netcandystore \
--create-namespace --timeout=1200s \
redhat-demos/netcandystore \
--set ssh.hostkey=${WSSHKEY} --set ssh.hostname=${WNODE}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Note that the <code>--timeout=1200s</code> is needed because the default timeout for <code>helm</code> is 5 minutes and, in most cases, the Windows container image will take longer than that to download.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will look like it&#8217;s "hanging" or "stuck". It&#8217;s not! What&#8217;s happening
is that the image is getting pulled into the Windows node. As stated
before, Windows containers can be very large, so it might take some time.</p>
</div>
<div class="paragraph">
<p>After some time, you should see something like the following return.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">NAME: ncs
LAST DEPLOYED: Sun Apr 24 23:16:05 2022
NAMESPACE: netcandystore
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
1. Get the application URL by running these commands:
oc get route netcandystore -n netcandystore -o jsonpath='{.spec.host}{"\n"}'

2. NOTE: The Windows container deployed only supports the following OS:

Windows Version:
=============
Windows Server 2019 Release 1809

Build Version:
=============

Major  Minor  Build  Revision
-----  -----  -----  --------
10     0      17763  0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Verify that the helm chart was installed successfully.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">helm ls -n netcandystore</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output should look something like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">NAME    NAMESPACE       REVISION        UPDATED                                 STATUS          CHART                   APP VERSION
ncs     netcandystore   1               2022-04-24 23:54:50.576808462 +0000 UTC deployed        netcandystore-1.0.1     3.1</code></pre>
</div>
</div>
<div class="paragraph">
<p>There should be 3 pods running for this application. One for the frondend
called netcandystore, one for the categories service called getcategories
and a DB called mysql.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get pods -n netcandystore</code></pre>
</div>
</div>
<div class="paragraph">
<p>Looking at the frontend application, you can list where the pod is
running. Comparing it to the nodes output, you can see it&#8217;s running on
a Windows Node.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get pods -n netcandystore -l app=netcandystore -o wide
oc get nodes -l kubernetes.io/os=windows</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, looking at the backend, you can see it&#8217;s running on a Linux node.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get pods -n netcandystore -l app=getcategories -o wide
oc get nodes -l kubernetes.io/os=linux</code></pre>
</div>
</div>
<div class="paragraph">
<p>The MSSQL Database is also running on the Linux node.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc get pods -n netcandystore -l deploymentconfig=mssql -o wide</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see the application by visiting the link:http://netcandystore-netcandystore.{{ ROUTE_SUBDOMAIN }}[Net Candystore Route].</p>
</div>
<div class="paragraph">
<p>The frontpage should look like this, feel free to play around with the application!</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ncs.png" alt="netcandy store page">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_conclusion">Conclusion</h4>
<div class="paragraph">
<p>In this lab you worked with Windows Containers on OpenShift Container
Platfrom. You saw how the cluster was prepared to support Windows
Containers. You also learned about the Windows Machine Config Operator and
how it&#8217;s used to provision a Windows Node.</p>
</div>
<div class="paragraph">
<p>You also learned about how to manage Windows Nodes using the MachineAPi
and how to manage Windows Container workloads using the same tools as
Linux Nodes.</p>
</div>
<div class="paragraph">
<p>Finally, you learned how you can used mixed workloads made up of Linux
and Windows containers.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-01-10 13:02:25 +0800
</div>
</div>
</body>
</html>